---
title: "draft_report"
author: "Hannah, Jeff, Josh Lin, Pauline"
date: "11/16/2020"
output: pdf_document
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "../reports/") })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(readxl)
library(janitor)
library(ggplot2)
```

```{r, warning = FALSE}
#combining the two excel sheets 
d <- read_excel("../data/interim/covid-19_v1.xlsx", sheet = "Covid-19", skip=1)
reopen <- read_excel("../data/interim/reopen_CUSP.xlsx", sheet = "Reopening")
total <- merge(d,reopen, by="state")
```

```{r}
#make values numeric 
total$reopen_state_bus = as.numeric(total$reopen_state_bus)
total$reopen_business_statewide = as.numeric(total$reopen_business_statewide)
```


```{r}
total$shelter_in_place = excel_numeric_to_date(total$shelter_in_place)
total$end_shelter_in_place = excel_numeric_to_date(total$end_shelter_in_place)
total$close_nonessential_business = excel_numeric_to_date(total$close_nonessential_business)
total$reopen_business_statewide = excel_numeric_to_date(total$reopen_business_statewide)
total$mandate_facemask = excel_numeric_to_date(total$mandate_facemask)
total$mandate_facemask_employee = excel_numeric_to_date(total$mandate_facemask_employee)
total$end_statewide_mandate_facemask = excel_numeric_to_date(total$end_statewide_mandate_facemask)

total$reopen_restaurants = excel_numeric_to_date(total$reopen_restaurants)
total$reopen_childcare = excel_numeric_to_date(total$reopen_childcare)
total$reopen_business_statewide = excel_numeric_to_date(as.numeric(total$reopen_business_statewide))
total$reopen_gyms = excel_numeric_to_date(total$reopen_gyms)
total$reopen_hair_salons = excel_numeric_to_date(total$reopen_hair_salons)
total$reopen_movie_theaters = excel_numeric_to_date(total$reopen_movie_theaters)
total$`reopen_non-essential_retail` = excel_numeric_to_date(total$`reopen_non-essential_retail`)
total$reopen_religious = excel_numeric_to_date(total$reopen_religious)
total$reopen_state_bus = excel_numeric_to_date(as.numeric(total$reopen_state_bus))
total$reopen_bars = excel_numeric_to_date(total$reopen_bars)
```

```{r}
write_csv(total, file = "../data/interim/covid19+cusp.csv")
```

```{r}
plot(total$`length_ shelter_in_place`, total$cases_per_100k)
total <- total %>% mutate(root_length_shelter = sqrt(`length_ shelter_in_place`))
plot(total$root_length_shelter, total$cases_per_100k)
```
```{r}
#baseline model
model1 <- lm(cases_per_100k ~ `length_ shelter_in_place`, data = total)
summary(model1)
```
```{r}
model_2 <- lm(cases_per_100k ~ `length_ shelter_in_place` + political_party_governor, data=total)
summary(model_2)
```
```{r}
counts <- table(total$cases_per_100k, total$political_party_governor)
par(mar=c(8,4,4,4))
barplot(data = party_cases, main="State Political Party and Cases",
        ylab = 'Cases per 100K',
        names.arg=c('Democratic', 'Republican'))
counts
```

```{r}
#filtering to find number of cases in dem and repub states 
dems <- filter(total, political_party_governor == 'Democratic')
repub <- filter(total, political_party_governor == 'Republican')
dem_cases <- sum(dems$cases_per_100k)
repub_cases <- sum(repub$cases_per_100k)
party_cases<- data.frame(dem_cases, repub_cases)
```



```{r}
ggplot(data = party_cases, aes(x= 'Cases', y = c(dem_cases, repub_cases))) + geom_bar(stat='identity'))
```

